
# LABORATORIO AVANZADO ‚Äì VERSI√ìN ACTUALIZADA

## Elasticsearch + Kibana (interactivo y visual)

Cl√∫ster: **Elasticsearch 8.x**
Entorno: **2 nodos** (es-node-1, es-node-2)
Frontend: **Kibana 8.x** (Stack Management ‚Üí Index Management)

---

# **0. Validaciones iniciales (terminal)**

```bash
curl -s http://localhost:9200/_cluster/health?pretty
curl -s http://localhost:9200/_cat/nodes?v
```

Confirma:

* 2 nodos
* status: **green**

---

# **1. Crear √≠ndice avanzado ‚Äì v√≠a curl (como estaba)**

(Lo mantengo igual; es perfecto para ense√±ar an√°lisis, nested y multi-field.)

```bash
curl -X PUT "http://localhost:9200/products-advanced" ...
```

---

# **2. Indexar documentos ‚Äì v√≠a curl (Bulk API)**

(Se mantiene igual.)

---

# **3. NUEVO: Revisar todo visualmente en Kibana**

Aqu√≠ empiezan los pasos visuales que quer√≠as.

---

# **[KIBANA] A. Ver el nuevo √≠ndice ‚Äúproducts-advanced‚Äù**

Ruta:

**Stack Management ‚Üí Index Management ‚Üí Indices**

All√≠ deber√≠as ver:

* products-advanced
* Estado: green
* Primaries: 1
* Replicas: 1
* Docs count: 4

Actividad para los alumnos:

1. Hacer clic en **products-advanced**
2. Revisar:

   * **Mappings**
   * **Settings**
   * **Shard allocation**

Es muy visual y ayuda a entender shards y r√©plicas.

---

# **[KIBANA] B. Ver d√≥nde est√°n los shards (visual üëå)**

En la ventana del √≠ndice:

1. Clic en **View Shard Allocation**
2. Kibana muestra:

* Shard primario en es-node-1
* Shard r√©plica en es-node-2

Esto hace tangible la HA del cl√∫ster.

---

# **[KIBANA] C. Crear un Index Pattern para usar Discover**

Ruta:

**Kibana ‚Üí Data Views ‚Üí Create data view**

Valores:

* **Name:** products-advanced
* **Index pattern:** products-advanced*
* **Time field:** available_from

Dar clic en **Create data view**.

Esto habilita Discover, Visualize y Dashboards.

---

# **[KIBANA] D. Buscar documentos desde Discover (sin curl)**

Ruta:

**Kibana ‚Üí Discover ‚Üí seleccionar products-advanced**

Pr√°cticas bonitas para los alumnos:

### Buscar laptops

```
category : "laptop"
```

### Buscar gaming

```
tags : gaming
```

### Buscar por nested usando KQL

```
attributes.key : "ram" and attributes.value : "32GB"
```

### Buscar texto analizado

```
description : "streaming"
```

Esto demuestra r√°pidamente la diferencia entre campos keyword/text.

---

# **[KIBANA] E. Visualizar datos con Lens (bonito y 100% guiado)**

Ruta:

**Kibana ‚Üí Visualize ‚Üí Lens**

### Ejercicio 1: Conteo de productos por categor√≠a

1. Drag & drop campo **category** a la zona de horizontal axis.
2. Drag & drop **Records** a vertical axis.
3. Crear una **barchart** autom√°ticamente.

Resultado: gr√°fico por categor√≠as (laptop, monitor, keyboard).

---

### Ejercicio 2: Agregaci√≥n temporal (date_histogram) sin curl

1. En Lens arrastra **available_from** ‚Üí Horizontal axis.
2. Kibana autom√°ticamente crea un **histograma mensual**.
3. Agrega **Records** como m√©trica.

Resultado: gr√°fico por meses de disponibilidad.

---

### Ejercicio 3: Medir diversidad con cardinalidad (visual)

1. Cambia m√©trica a **Unique count of tags**
2. Muestra cu√°ntos tags √∫nicos existen.

---

# **4. NUEVO: Crear visualizaciones + Dashboard**

### [KIBANA] Crear un dashboard real:

Ruta:

**Kibana ‚Üí Dashboard ‚Üí Create Dashboard**

Agrega:

* Gr√°fico de categor√≠as
* Histograma por fecha
* Tabla de productos (Discover ‚Üí Save as Lens ‚Üí Add to dashboard)

Esto le da un toque profesional al laboratorio y hace que los alumnos digan ‚Äúwow, esto es Elastic de verdad‚Äù.

---

# **5. NUEVO: Interacci√≥n con filtros visuales**

En el dashboard, los alumnos pueden:

* filtrar haciendo clic sobre una categor√≠a
* combinar filtros
* ver c√≥mo cambian todas las visualizaciones al mismo tiempo

---

# **6. Mantener las consultas avanzadas en curl**

Tus b√∫squedas fuzzy, phrase con slop, regexp y bool siguen siendo perfectas para la parte t√©cnica.

Podemos agregar un paso visual despu√©s:

# **[KIBANA] Mostrar Query DSL generado autom√°ticamente**

En Discover:

1. Haz una b√∫squeda
2. Abre el panel lateral
3. Ve a **Inspect ‚Üí Request ‚Üí Query DSL**

Kibana mostrar√° el JSON exacto equivalente a la b√∫squeda KQL.

Esto es una clase magistral para entender c√≥mo KQL ‚Üí DSL ‚Üí Lucene.

---

# **7. NUEVO: Mostrar shards de forma visual desde Console**

Ruta:

**Kibana ‚Üí Dev Tools ‚Üí Console**

Pide a los alumnos ejecutar:

```
GET _cat/shards/products-advanced?v
```

Ver√°n:

* un shard primario (p)
* una r√©plica (r)
* nodos donde est√°n asignados

---

# **8. NUEVO: Mostrar el ILM (si se usa luego)**

Aunque este lab no usa ILM, puedes mostrarlo visualmente:

Ruta:

**Stack Management ‚Üí Data ‚Üí Index Lifecycle Policies**

---

# Resumen ‚Äì Lo que agregamos a Kibana (lo que pediste)

Los pasos visuales nuevos para los alumnos:

1. Ver √≠ndices y shards en Kibana
2. Crear data view
3. Usar Discover
4. KQL b√°sico
5. KQL con nested
6. Crear visualizaciones con Lens
7. Crear dashboard profesional
8. Ver Query DSL generado
9. Usar Dev Tools para inspeccionar shards
10. Visualizar mappings y settings



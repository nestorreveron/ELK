# ğŸ› ï¸ Laboratorio: InstalaciÃ³n y configuraciÃ³n bÃ¡sica de Elasticsearch en Azure

## ğŸ“‹ **Objetivo**

Instalar y configurar Elasticsearch en una mÃ¡quina virtual (VM) en Azure para cada usuario individualmente, usando un grupo de recursos propio.

---

## ğŸ“ **Requisitos previos**

* Cuenta Azure con presupuesto asignado (\$50 USD por usuario).
* Acceso al [Azure Portal](https://portal.azure.com).
* Terminal SSH (recomendado: Bash, PowerShell o similar).

---

## âš™ï¸ **Paso 1: CreaciÃ³n del Grupo de Recursos**

Cada estudiante crea su propio grupo:

* Nombre sugerido: `USER01-RG`, `USER02-RG`, etc.
* RegiÃ³n recomendada: `East US 2` o la mÃ¡s cercana.

**Procedimiento:**

1. Inicia sesiÃ³n en [Azure Portal](https://portal.azure.com).
2. DirÃ­gete a **Resource Groups** â†’ **Create**.
3. Ingresa nombre (ej.: `USER01-RG`) y regiÃ³n.
4. Click en **Review + create** y luego en **Create**.

---

## âš™ï¸ **Paso 2: Crear una Virtual Network (VNet)**

Dentro del grupo creado:

* Nombre: `USER01-VNet`
* Address Space: `10.0.0.0/16`
* Subnet: `default` con rango `10.0.0.0/24`

**Procedimiento:**

1. Ingresa al grupo de recursos creado.
2. Click en **+ Add** â†’ busca **Virtual Network**.
3. Llena los datos anteriores.
4. Click en **Review + create** y luego **Create**.

---

## âš™ï¸ **Paso 3: Crear MÃ¡quina Virtual (VM)**

* Nombre VM: `USER01-VM`
* Imagen: **Ubuntu Server 22.04 LTS**
* TamaÃ±o recomendado: `Standard_B2s` (econÃ³mico)
* AutenticaciÃ³n: SSH (generar y guardar claves)

**Procedimiento:**

1. Desde el grupo de recursos, click en **+ Add**, busca **Virtual Machine**.
2. Configura segÃºn los datos anteriores.
3. En Networking, asocia la VM a la `USER01-VNet`.
4. Click en **Review + create** y luego **Create**.

> âš ï¸ **Importante:** Guarda cuidadosamente la clave SSH generada.

---

## âš™ï¸ **Paso 4: Conectarte a la Azure VM**

* Usa SSH para conectarte:

```bash
ssh usuario@<ip-publica-vm>
```

---

## âš™ï¸ **Paso 5: InstalaciÃ³n de Java**

Dentro de la VM ejecuta:

```bash
sudo apt update
sudo apt install openjdk-17-jdk -y
java -version
```

---

## âš™ï¸ **Paso 6: InstalaciÃ³n de Elasticsearch**

```bash
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elasticsearch-keyring.gpg

echo "deb [signed-by=/usr/share/keyrings/elasticsearch-keyring.gpg] https://artifacts.elastic.co/packages/8.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-8.x.list

sudo apt update
sudo apt install elasticsearch -y
```

---

## âš™ï¸ **Paso 7: Configurar Elasticsearch**

Edita configuraciÃ³n:

```bash
sudo nano /etc/elasticsearch/elasticsearch.yml
```

AÃ±ade/modifica:

```yaml
network.host: 0.0.0.0
http.port: 9200
discovery.type: single-node
xpack.security.enabled: false
```

Guarda (`Ctrl+X`, `Y`, `Enter`).

---

## âš™ï¸ **Paso 8: Iniciar Elasticsearch**

```bash
sudo systemctl enable elasticsearch
sudo systemctl start elasticsearch
sudo systemctl status elasticsearch
```

Verifica instalaciÃ³n:

```bash
curl -X GET "localhost:9200"
```

---

## âš™ï¸ **Paso 9: Acceso desde navegador**

En Azure, permite acceso al puerto `9200`:

* VM â†’ **Networking** â†’ AÃ±ade regla entrante `TCP 9200`.

Accede vÃ­a navegador:

```
http://<ip-publica-vm>:9200
```

---

## âš™ï¸ **Paso 10: Operaciones CRUD bÃ¡sicas**

Desde terminal VM:

**Crear Ã­ndice:**

```bash
curl -X PUT "localhost:9200/mi_indice"
```

**Crear documento:**

```bash
curl -X POST "localhost:9200/mi_indice/_doc/" -H 'Content-Type: application/json' -d'
{
  "curso": "Elasticsearch",
  "empresa": "Kyndryl",
  "duracion": "2 horas"
}'
```

**Consultar documentos:**

```bash
curl -X GET "localhost:9200/mi_indice/_search?pretty"
```

**Actualizar documento:** *(usa tu document\_id)*

```bash
curl -X POST "localhost:9200/mi_indice/_update/<document_id>" -H 'Content-Type: application/json' -d'
{
  "doc": {"duracion": "4 horas"}
}'
```

**Eliminar documento:** *(usa tu document\_id)*

```bash
curl -X DELETE "localhost:9200/mi_indice/_doc/<document_id>"
```

---

## ğŸš® **Limpieza de recursos** *(Opcional al finalizar)*

Desde Azure Portal, elimina tu grupo de recursos:

* Ve a tu **Resource Group** â†’ **Delete resource group**.

---

## ğŸ“Œ **Recomendaciones finales**

* Monitorea regularmente tu uso en Azure.
* Guarda evidencia de resultados y comandos realizados.
* Comparte dudas o problemas durante el curso.

---

Â¡Buen trabajo! ğŸš€ Ahora tienes Elasticsearch funcionando en tu Azure VM.
